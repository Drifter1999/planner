<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar with Itinerary</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css">
    <link rel="stylesheet" href="path/to/your/custom/header.css">
    <link rel="stylesheet" href="path/to/your/custom/footer.css">

    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/slicknav.css">
    <link rel="stylesheet" href="/assets/css/flaticon.css">
    <link rel="stylesheet" href="/assets/css/animate.min.css">
    <link rel="stylesheet" href="/assets/css/magnific-popup.css">
    <link rel="stylesheet" href="/assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="/assets/css/themify-icons.css">
    <link rel="stylesheet" href="/assets/css/slick.css">
    <link rel="stylesheet" href="/assets/css/nice-select.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
<header>
    <div th:insert="~{fragment/header :: header}"></div>
</header>
<main>
    <!-- Hero Start-->
    <div class="hero-area2  slider-height2 hero-overly2 d-flex align-items-center ">
        <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <div class="hero-cap text-center pt-50">
                        <h2>Calendar - 일정</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Hero End -->
    <div id="calendar"></div>
</main>
<footer>
    <div th:insert="~{fragment/footer1 :: footer1}"></div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
<script>
    $(document).ready(function() {
      // Check login status
      var isLoggedIn = checkLoginStatus(); // Implement your login status check logic here

      if (isLoggedIn) {
        // Retrieve user's travel data
        var travelData = getUserTravelData(); // Implement your logic to retrieve user's travel data

        // Transform travel data into itinerary events
        var itineraryEvents = transformTravelDataToEvents(travelData); // Implement your logic to transform travel data into events

        // Initialize the calendar
        $('#calendar').fullCalendar({
          // Set your desired options and configurations
          // For example, set the calendar to display a month view by default
          defaultView: 'month',

          // Add the itinerary events
          events: itineraryEvents,

          // Customize event rendering to display itinerary events differently
          eventRender: function(event, element) {
            if (event.itinerary) {
              element.addClass('itinerary-event');
            }
          },

          // Add a click event handler for itinerary events
          eventClick: function(event) {
            if (event.itinerary) {
              alert('Itinerary event: ' + event.title + '\nDescription: ' + event.description);
            }
          }
        });

        // Declare variable for current itinerary index
        var currentItineraryIndex = 0;

        // Function to show the next travel date
        function showNextTravelDate() {
          // Update the current itinerary index
          currentItineraryIndex = (currentItineraryIndex + 1) % itineraryEvents.length;

          // Get the next travel event
          var nextTravelEvent = itineraryEvents[currentItineraryIndex];

          // Show the calendar for the next travel date
          $('#calendar').fullCalendar('gotoDate', nextTravelEvent.start);
        }

        // Function to find the next travel event
        function findNextTravelEvent(events) {
          var today = moment().startOf('day');
          var nextEvent = null;

          for (var i = 0; i < events.length; i++) {
            var eventStart = moment(events[i].start).startOf('day');

            if (eventStart.isAfter(today)) {
              nextEvent = events[i];
              break;
            }
          }

          return nextEvent;
        }

        // Find the next travel event
        var nextTravelEvent = findNextTravelEvent(itineraryEvents);

        // Show the next travel date button
        if (nextTravelEvent) {
          var nextTravelButtonHtml = '<button onclick="showNextTravelDate()">Show Next Travel Date</button>';
          $('#calendar').prepend(nextTravelButtonHtml);
        }
      } else {
        // Handle not logged in state (redirect to login page, display a message, etc.)
        alert('Please log in to view the calendar.');
        // Implement your logic for handling not logged in state
      }
    });

    function checkLoginStatus() {
      // Implement your login status check logic here
      // Return true if the user is logged in, false otherwise
      return true; // Example: Assume the user is logged in
    }

    function getUserTravelData() {
      // Implement your logic to retrieve user's travel data
      // Return the travel data for the logged-in user
      return [
        {
          title: '부산여행',
          start: '2023-05-28T10:00:00',
          end: '2023-05-29T11:30:00',
          description: '부산여행',
          itinerary: true
        },
        {
          title: '제주도',
          start: '2023-07-04T12:00:00',
          end: '2023-07-07T13:00:00',
          description: '제주도',
          itinerary: true
        }
        // Add more travel data as needed
      ];
    }

    function transformTravelDataToEvents(travelData) {
      // Implement your logic to transform travel data into events
      // Return the transformed itinerary events

      var itineraryEvents = [];

      for (var i = 0; i < travelData.length; i++) {
        var event = {
          title: travelData[i].title,
          start: travelData[i].start,
          end: travelData[i].end,
          description: travelData[i].description,
          itinerary: true
        };

        itineraryEvents.push(event);
      }

      return itineraryEvents;
    }
</script>
<style>
    .itinerary-event {
      background-color: #ffc107;
      border-color: #ffc107;
      color: #000;
    }
</style>
</body>
</html>
